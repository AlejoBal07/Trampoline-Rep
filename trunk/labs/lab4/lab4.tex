\documentclass[11pt]{article}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\usepackage{hyperref}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{underscore}
\usepackage{parskip}
\usepackage[nosolutionfiles]{answers}
\usepackage{tikz}
\usetikzlibrary{arrows,automata,shapes,snakes,patterns,decorations}
\usetikzlibrary{shapes.callouts}
\usetikzlibrary{shadows}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usepackage{adjustbox}
\usepackage{listings}

\newcommand{\normaltilde}{{\raise.17ex\hbox{$\scriptstyle\mathtt{\sim}$}}}
\newcommand{\unixcl}[1]{\texttt{\fcolorbox{black}{gray!20}{#1}}}

\Newassociation{sol}{Solution}{ans}
\newtheorem{ex}{Question}

\lstset{
  language=C,
  basicstyle=\ttfamily\footnotesize,
  commentstyle=\itshape\color{cyan}
}

\title{Lab \#4\\$\star$\\Internal communication}
\author{}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle

{\bf Note:} All the software and documents are stored at \url{http://www.irccyn.ec-nantes.fr/~bechenne/trampoline}

\section{Goal}

Internal messaging may be used as an easy to use replacement to shared variables. Messaging allow to send data from a task to one or many task. This lab will show the different ways to communicate in OSEK.Related course spans from slides 96 to 109.
Go into the \texttt{labs/lab4} directory. It contains an application having 2 tasks that communicate.
Examine the lab4.oil and the lab4.c filesThe OIL file declare 2 tasks: \texttt{sender} and \texttt{receiver} and 2 messages: \texttt{outMessage} and \texttt{inMessage}. \texttt{inMessage} is connected to \texttt{outMessage}. Task \texttt{sender} uses \texttt{outMessage} and task \texttt{receiver} uses \texttt{inMessage}.Task \texttt{sender} is executed every second by the mean of an alarm and send a data using \texttt{outMessage}. When the message is received in \texttt{inMessage}, the notification activates task \texttt{receiver}. \texttt{receiver} receive the message from \texttt{inMessage} and print the value.

\section{Message broadcasting}
OSEK messaging allows the one to many communication. This is done by having more than one receiving messages connected to the same sending message.
\begin{ex}
Add 2 other receiving messages connected to \texttt{outMessage}. The first message activates the task \texttt{Emergency} (add the corresponding task), the second message sets an event to task \texttt{NormalOperation} (add the corresponding extended tasks too). Write the C code of the tasks you added. The first one receive the message and prints the value, the second one waits for the event in an infinite loop, receive the message and prints the value. Check the application works as expected.
\end{ex}

\section{Filtering}
Look at the filtering principles (slides 106 to 109).

\begin{ex}
Add a filter to activate task \texttt{receiver} for the 4th and then every 3 values (ie 4th, 7th, 11st and so on).\end{ex}
\begin{ex}
Modify task \texttt{sender} to send a random value ranging from 0 to 100. Using filtering, set the event to task \texttt{NormalOperation} only if the value is within the $[20,60]$ range and activate task \texttt{Emergency} only if the value is not within the range.
\end{ex}

\section{Queued messages}
Look at slide 102

\begin{ex}Restarting with the Messaging application, modify the \texttt{inMessage} to make it a queued message with a size of 4 and remove the notification. Add an alarm to activate task receiver every 4 seconds. Check the return value of \texttt{ReceiveMessage} and verify no error occurred (queue under- or over-flow).If errors occur, propose a modification to correct it
\end{ex}

\end{document}  