/*-----------------------------------------------------------------------------
 * Task % !task::NAME % descriptor
 */
#define APP_% !task::KIND %_% !task::NAME %_START_SEC_CODE
#include "tpl_memmap.h"
/*
 * Task % !task::NAME % function prototype
 */
FUNC(void, OS_APPL_CODE) % !task::NAME %_function(void);
#define APP_Task_% !task::NAME %_STOP_SEC_CODE
#include "tpl_memmap.h"

/*-----------------------------------------------------------------------------
 * Target specific structures
 */
%
let proc := task
template process_specific
%

#if WITH_AUTOSAR_TIMING_PROTECTION == YES
#define OS_START_SEC_VAR_UNSPECIFIED
#include "tpl_memmap.h"
%
# *TODO
%
#define OS_STOP_SEC_VAR_UNSPECIFIED
#include "tpl_memmap.h"
#endif

/*
%
if exists TIMINGPROTECTION then
% * EXECUTIONBUDGET = % !TIMINGPROTECTION::EXECUTIONBUDGET %, TIMEFRAME = % !TIMINGPROTECTION::TIMEFRAME %
 * MAXOSINTERRUPTLOCKTIME = % !TIMINGPROTECTION::MAXOSINTERRUPTLOCKTIME %, MAXALLINTERRUPTLOCKTIME = % !TIMINGPROTECTION::MAXALLINTERRUPTLOCKTIME %
%
else
%  No timing protection
%
end if
% */

#define OS_START_SEC_CONST_UNSPECIFIED
#include "tpl_memmap.h"

%
if exists task::RESOURCE then
%/*
 * Resources used by task % !task::NAME %
 *
 * %
foreach resource in task::RESOURCE do
 !resource::VALUE
between %, %
end foreach
%
 */
%end if%
/*
 * Static descriptor of task % !task::NAME %
 */
CONST(tpl_proc_static, OS_CONST) % !task::NAME %_task_stat_desc = {
  /* context                  */  % !task::NAME %_CONTEXT,
  /* stack                    */  % !task::NAME %_STACK,
  /* entry point (function)   */  % !task::NAME %_function,
  /* internal ressource       */  %
if task::USEINTERNALRESOURCE then
  %&%!task::INTERNALRESOURCE%_rez_desc,%
elsif task::NONPREEMPTABLE then
  %&INTERNAL_RES_SCHEDULER,%
else
  %NULL,%
end if
%
  /* task id                  */  % !task::NAME %_id,
#if WITH_OSAPPLICATION == YES
  /* OS application id        */  %
if AUTOSAR then
  if OS::SCALABILITYCLASS >= 3 then
    if exists task::APPLICATION then
      !task::APPLICATION%_id,%
    else
      %INVALID_OSAPPLICATION_ID,%
    end if
  end if
end if
%
#endif
  /* task base priority       */  % !task::PRIORITY %,
  /* max activation count     */  % !task::ACTIVATION %,
  /* task type                */  TASK_%
if exists task::EVENT then
  %EXTENDED,%
else
  %BASIC,%
end if
%
#if WITH_AUTOSAR_TIMING_PROTECTION == YES
  /* pointer to the timing
     protection descriptor    */  $TIMING_PROT_REF$
#endif
};

#define OS_STOP_SEC_CONST_UNSPECIFIED
#include "tpl_memmap.h"


#define OS_START_SEC_VAR_UNSPECIFIED
#include "tpl_memmap.h"
/*
 * Dynamic descriptor of task % !task::NAME %
 */
VAR(tpl_proc, OS_VAR) % !task::NAME %_task_desc = {
  /* resources                      */  NULL,
#if WITH_OSAPPLICATION == YES
  /* if > 0 the process is trusted  */  %
if AUTOSAR then
  if OS::SCALABILITYCLASS > 2 then
    if exists task::TRUSTED default (false) then !1 else !0 end if
  end if
else
  !0
end if
%,    
#endif /* WITH_OSAPPLICATION */
  /* activate count                 */  0,
  /* task priority                  */  % !task::PRIORITY %,
  /* task state                     */  %
if task::AUTOSTART then
  %AUTOSTART%
else
  %SUSPENDED%
end if 
%
};
%
if exists task::EVENT then
%
/*
 * Event structure of task % !task::NAME %
 */
VAR(tpl_task_events, OS_VAR) % !task::NAME %_task_evts = {
  /* event set  */ 0,
  /* event wait */ 0
};
%
end if
%
#define OS_STOP_SEC_VAR_UNSPECIFIED
#include "tpl_memmap.h"

