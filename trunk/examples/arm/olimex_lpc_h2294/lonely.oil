// first run: 
//goil --target=arm/olimex_lpc_h2294 --templates=../../../goilv2/templates/ lonely.oil

OIL_VERSION = "2.5" : "test" ;

IMPLEMENTATION trampoline {
  TASK {
    UINT32 STACKSIZE = 500 ;
    UINT32 PRIORITY = 1 ;
  } ;
  ISR {
    UINT32 STACKSIZE = 500 ;
  };
};

CPU test {
  OS config {
    STATUS = EXTENDED;
    ERRORHOOK = FALSE;
    PRETASKHOOK = FALSE;
    BUILD = TRUE {
        APP_SRC = "lonely.c";
        APP_NAME = "lonely_exe";
        TRAMPOLINE_BASE_PATH = "../../..";
        CFLAGS = "-g -c -ffreestanding -fsigned-char -mcpu=arm7tdmi -Os -Winline -Wall -Werror-implicit-function-declaration --param max-inline-insns-single=1000 -ffunction-sections -fdata-sections -std=gnu99";
        ASFLAGS = "-g -mcpu=arm7tdmi-s --fatal-warnings ";
        LDFLAGS = "-g --cref --allow-multiple-definition --gc-sections";
        LDFLAGS = " -g --fatal-warnings --warn-common  --no-undefined -Map lonely.map";
        
        COMPILER = "arm-elf-gcc";
        ASSEMBLER = "arm-elf-as";
        LINKER = "arm-elf-ld";
    };
    SYSTEM_CALL = TRUE;
    MEMMAP = TRUE{
      COMPILER = gcc;
      LINKER = gnu_ld { SCRIPT = "script.ld"; };
      ASSEMBLER = gnu_as;
      MEMORY_PROTECTION = FALSE;
    };
  };
  
  APPMODE std {
  };

  TASK periodicTask {
    PRIORITY = 1;
    AUTOSTART = FALSE;
    ACTIVATION = 1;
    SCHEDULE = FULL;
  };   
        
  COUNTER SystemCounter { 
    SOURCE = it_timer1; 
    MAXALLOWEDVALUE = 2000;
    TICKSPERBASE = 10; //10 ms.
    MINCYCLE = 1; 
  };
    
  ALARM Alarm1{
    COUNTER = SystemCounter;
    ACTION = ACTIVATETASK {
      TASK = periodicTask;
    };
    AUTOSTART = TRUE {
      ALARMTIME = 100; //first activation in 1s after StartOS
      CYCLETIME = 100; //period 1s
      APPMODE = std;
    };
  };
};
