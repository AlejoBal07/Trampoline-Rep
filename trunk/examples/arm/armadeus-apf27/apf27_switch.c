#include "apf27_switch.h"
#include "tpl_os_internal_types.h"

#define PORT_AT(address) (*((u32*)address))

#define PTF_DDIR PORT_AT(0x10015500)
#define PTA_OCR1 PORT_AT(0x10015004)
#define PTB_OCR1 PORT_AT(0x10015104)
#define PTC_OCR1 PORT_AT(0x10015204)
#define PTD_OCR1 PORT_AT(0x10015304)
#define PTE_OCR1 PORT_AT(0x10015404)
#define PTF_OCR1 PORT_AT(0x10015504)
#define PTA_OCR2 PORT_AT(0x10015008)
#define PTB_OCR2 PORT_AT(0x10015108)
#define PTC_OCR2 PORT_AT(0x10015208)
#define PTD_OCR2 PORT_AT(0x10015308)
#define PTE_OCR2 PORT_AT(0x10015408)
#define PTF_OCR2 PORT_AT(0x10015508)
#define PTA_ICONFA1 PORT_AT(0x1001500C)
#define PTB_ICONFA1 PORT_AT(0x1001510C)
#define PTC_ICONFA1 PORT_AT(0x1001520C)
#define PTD_ICONFA1 PORT_AT(0x1001530C)
#define PTE_ICONFA1 PORT_AT(0x1001540C)
#define PTF_ICONFA1 PORT_AT(0x1001550C)
#define PTA_ICONFA2 PORT_AT(0x10015010)
#define PTB_ICONFA2 PORT_AT(0x10015110)
#define PTC_ICONFA2 PORT_AT(0x10015210)
#define PTD_ICONFA2 PORT_AT(0x10015310)
#define PTE_ICONFA2 PORT_AT(0x10015410)
#define PTF_ICONFA2 PORT_AT(0x10015510)
#define PTA_ICONFB1 PORT_AT(0x10015014)
#define PTB_ICONFB1 PORT_AT(0x10015114)
#define PTC_ICONFB1 PORT_AT(0x10015214)
#define PTD_ICONFB1 PORT_AT(0x10015314)
#define PTE_ICONFB1 PORT_AT(0x10015414)
#define PTF_ICONFB1 PORT_AT(0x10015514)
#define PTA_ICONFB2 PORT_AT(0x10015018)
#define PTB_ICONFB2 PORT_AT(0x10015118)
#define PTC_ICONFB2 PORT_AT(0x10015218)
#define PTD_ICONFB2 PORT_AT(0x10015318)
#define PTE_ICONFB2 PORT_AT(0x10015418)
#define PTF_ICONFB2 PORT_AT(0x10015518)
#define PTA_DR PORT_AT(0x1001501C)
#define PTB_DR PORT_AT(0x1001511C)
#define PTC_DR PORT_AT(0x1001521C)
#define PTD_DR PORT_AT(0x1001531C)
#define PTE_DR PORT_AT(0x1001541C)
#define PTF_DR PORT_AT(0x1001551C)
#define PTA_GIUS PORT_AT(0x10015020)
#define PTB_GIUS PORT_AT(0x10015120)
#define PTC_GIUS PORT_AT(0x10015220)
#define PTD_GIUS PORT_AT(0x10015320)
#define PTE_GIUS PORT_AT(0x10015420)
#define PTF_GIUS PORT_AT(0x10015520)
#define PTA_SSR PORT_AT(0x10015024)
#define PTB_SSR PORT_AT(0x10015124)
#define PTC_SSR PORT_AT(0x10015224)
#define PTD_SSR PORT_AT(0x10015324)
#define PTE_SSR PORT_AT(0x10015424)
#define PTF_SSR PORT_AT(0x10015524)
#define PTA_ICR1 PORT_AT(0x10015028)
#define PTB_ICR1 PORT_AT(0x10015128)
#define PTC_ICR1 PORT_AT(0x10015228)
#define PTD_ICR1 PORT_AT(0x10015328)
#define PTE_ICR1 PORT_AT(0x10015428)
#define PTF_ICR1 PORT_AT(0x10015528)
#define PTA_ICR2 PORT_AT(0x1001502C)
#define PTB_ICR2 PORT_AT(0x1001512C)
#define PTC_ICR2 PORT_AT(0x1001522C)
#define PTD_ICR2 PORT_AT(0x1001532C)
#define PTE_ICR2 PORT_AT(0x1001542C)
#define PTF_ICR2 PORT_AT(0x1001552C)
#define PTA_IMR PORT_AT(0x10015030)
#define PTB_IMR PORT_AT(0x10015130)
#define PTC_IMR PORT_AT(0x10015230)
#define PTD_IMR PORT_AT(0x10015330)
#define PTE_IMR PORT_AT(0x10015430)
#define PTF_IMR PORT_AT(0x10015530)
#define PTA_ISR PORT_AT(0x10015034)
#define PTB_ISR PORT_AT(0x10015134)
#define PTC_ISR PORT_AT(0x10015234)
#define PTD_ISR PORT_AT(0x10015334)
#define PTE_ISR PORT_AT(0x10015434)
#define PTF_ISR PORT_AT(0x10015534)
#define PTA_GPR PORT_AT(0x10015038)
#define PTB_GPR PORT_AT(0x10015138)
#define PTC_GPR PORT_AT(0x10015238)
#define PTD_GPR PORT_AT(0x10015338)
#define PTE_GPR PORT_AT(0x10015438)
#define PTF_GPR PORT_AT(0x10015538)
#define PTA_SWR PORT_AT(0x1001503C)
#define PTB_SWR PORT_AT(0x1001513C)
#define PTB_SWR PORT_AT(0x1001513C)
#define PTD_SWR PORT_AT(0x1001533C)
#define PTE_SWR PORT_AT(0x1001543C)
#define PTF_SWR PORT_AT(0x1001553C)
#define PTA_PUEN PORT_AT(0x10015040)
#define PTB_PUEN PORT_AT(0x10015140)
#define PTC_PUEN PORT_AT(0x10015240)
#define PTD_PUEN PORT_AT(0x10015340)
#define PTE_PUEN PORT_AT(0x10015440)
#define PTF_PUEN PORT_AT(0x10015540)
#define PMASK PORT_AT(0x10015600)

void apf27_s1_init ()
{
	volatile int tempo;

	/* we only configure PORT F, all pins at input (no short circuit risks) 
	 * and pin PF13 configured as interrupt source
	 */
	
  PTF_DDIR &= ~(1 << 13);
  PTF_ICONFA1 |= 1 << 26; // port 13 = interrupt
  PTF_ICONFA2 |= 0;
  PTF_ICONFB1 |= 1 << 26;
  PTF_ICONFB2 |= 0;
  PTF_GIUS |= 1 << 13; // port 13 = input pin used by GPIO
  PTF_ICR1 &= ~(3 << 26); // interrupt at rising edge
  PTF_ICR2 |= 0;
  PTF_IMR |= 1 << 13; // interrupt on pin 13 not masked
  //PTF_GPR // unuseful
  PTF_PUEN &= ~(1 << 13); // no internal pull up (provided by APF27-Dev)
  PMASK |= 1 << 5; // interrupts enabled on PORT F
}

void apf27_s1_ack_int ()
{
  PTF_ISR = 1 << 13;
}
